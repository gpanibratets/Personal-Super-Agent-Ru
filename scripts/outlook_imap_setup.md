# Настройка работы с Office 365 через IMAP/SMTP (без Azure)

Этот вариант **не требует** регистрации приложения в Azure и административных разрешений. Использует стандартные протоколы IMAP и SMTP.

## Шаг 1: Включение IMAP в Outlook

1. Откройте [Outlook в браузере](https://outlook.office.com/)
2. Перейдите в **Настройки** (Settings) → **Просмотр всех настроек Outlook** (View all Outlook settings)
3. Выберите **Почта** → **Синхронизация электронной почты**
4. Убедитесь, что **IMAP** включен

## Шаг 2: Создание пароля приложения (если включена 2FA)

Если у вас включена двухфакторная аутентификация:

1. Перейдите на [account.microsoft.com/security](https://account.microsoft.com/security)
2. Войдите в свой аккаунт Microsoft
3. Выберите **Безопасность** → **Дополнительные параметры безопасности**
4. Найдите **Пароли приложений** (App passwords)
5. Создайте новый пароль приложения
6. **Скопируйте пароль** — он показывается только один раз!

**Важно:** Используйте этот пароль приложения вместо обычного пароля в конфигурации.

## Шаг 3: Настройка конфигурации

1. Запустите скрипт один раз (он создаст файл конфигурации):
   ```bash
   python3 scripts/outlook_imap.py list
   ```

2. Откройте файл `scripts/outlook_imap_config.json`

3. Заполните данные:
   ```json
   {
     "email": "ваш_email@domain.com",
     "password": "ваш_пароль_или_пароль_приложения",
     "imap_server": "outlook.office365.com",
     "imap_port": 993,
     "smtp_server": "smtp.office365.com",
     "smtp_port": 587
   }
   ```

## Шаг 4: Использование

### Просмотр списка писем:
```bash
# Последние 10 писем
python3 scripts/outlook_imap.py list

# Последние 5 писем
python3 scripts/outlook_imap.py list --limit 5

# Письма из отправленных
python3 scripts/outlook_imap.py list --folder Sent
```

### Чтение письма:
```bash
# Прочитать первое письмо
python3 scripts/outlook_imap.py read --index 0
```

### Отправка письма:
```bash
# Простое письмо
python3 scripts/outlook_imap.py send \
  --to "recipient@example.com" \
  --subject "Тема письма" \
  --body "Текст письма"

# Письмо с вложением
python3 scripts/outlook_imap.py send \
  --to "recipient@example.com" \
  --subject "Документ" \
  --body "См. вложение" \
  --attach "/path/to/file.pdf"
```

## Преимущества этого метода:

✅ Не требует Azure Portal  
✅ Не требует административных разрешений  
✅ Работает с личными и корпоративными аккаунтами  
✅ Простая настройка  

## Ограничения:

⚠️ Требует пароль приложения при включенной 2FA  
⚠️ Может быть отключен администратором в корпоративных аккаунтах  
⚠️ Меньше функций, чем через Graph API  

## Безопасность:

- Файл `outlook_imap_config.json` автоматически добавлен в `.gitignore`
- Пароль не будет закоммичен в Git
- Не делитесь паролем с другими

## Устранение проблем

### Ошибка: "IMAP4.error: LOGIN failed"
- Проверьте правильность email и пароля
- Если включена 2FA, используйте пароль приложения
- Убедитесь, что IMAP включен в настройках Outlook

### Ошибка: "SMTPAuthenticationError"
- Проверьте правильность пароля
- Используйте пароль приложения, если включена 2FA
- Убедитесь, что SMTP не заблокирован администратором

