# Настройка отправки файлов в Telegram

Этот скрипт позволяет отправлять файлы и сообщения в Telegram прямо из командной строки.

## Шаг 1: Создание Telegram бота

1. Откройте Telegram и найдите **@BotFather**
2. Отправьте команду `/newbot`
3. Следуйте инструкциям:
   - Введите имя бота (например: "My Personal Assistant Bot")
   - Введите username бота (должен заканчиваться на `bot`, например: `my_personal_bot`)
4. BotFather выдаст вам **токен бота** (выглядит как: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
5. **Сохраните токен** - он понадобится на следующем шаге

## Шаг 2: Получение Chat ID

Есть несколько способов получить Chat ID:

### Способ 1: Через бота @userinfobot (самый простой)

1. Найдите в Telegram бота **@userinfobot**
2. Отправьте ему любое сообщение (например: `/start`)
3. Бот покажет ваш Chat ID (число, например: `123456789`)

### Способ 2: Через API (если способ 1 не работает)

1. Отправьте любое сообщение вашему боту (тому, который вы создали)
2. Откройте в браузере:
   ```
   https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates
   ```
   Замените `<ВАШ_ТОКЕН>` на токен, который дал BotFather
3. Найдите в ответе `"chat":{"id":123456789}` - это ваш Chat ID

### Способ 3: Для групповых чатов

1. Добавьте бота в группу
2. Отправьте сообщение в группу
3. Используйте API как в способе 2, но ищите `"chat":{"id":-123456789}` (отрицательное число для групп)

## Шаг 3: Настройка конфигурации

1. Запустите скрипт один раз (он создаст файл конфигурации):
   ```bash
   python3 scripts/send_to_telegram.py --text "test"
   ```

2. Откройте файл `scripts/telegram_config.json`

3. Заполните данные:
   ```json
   {
     "bot_token": "123456789:ABCdefGHIjklMNOpqrsTUVwxyz",
     "chats": {
       "myself": "123456789",
       "doctor": "987654321",
       "family": "-123456789"
     },
     "default_chat": "myself"
   }
   ```

   **Структура:**
   - `bot_token` - токен вашего бота от BotFather
   - `chats` - объект с именами чатов и их Chat ID или username
     - Можно добавить любое количество чатов с понятными именами
     - Например: "doctor", "myself", "family", "work", "friends", "wife"
     - **Chat ID**: числовой идентификатор (например: `"123456789"`)
     - **Username**: начинается с @ (например: `"@username"`)
       - ⚠️ Для отправки по username пользователь должен начать диалог с ботом (отправить /start)
   - `default_chat` - имя чата по умолчанию (используется, если не указан `--chat`)

## Шаг 4: Использование

### Отправка файла (в чат по умолчанию):
```bash
python3 scripts/send_to_telegram.py /path/to/file.txt
```

### Отправка файла в конкретный чат:
```bash
python3 scripts/send_to_telegram.py /path/to/file.txt --chat doctor
```

### Отправка файла с подписью:
```bash
python3 scripts/send_to_telegram.py /path/to/file.txt "Результаты анализов" --chat doctor
```

### Отправка текстового сообщения:
```bash
# В чат по умолчанию
python3 scripts/send_to_telegram.py --text "Привет!"

# В конкретный чат
python3 scripts/send_to_telegram.py --text "Привет!" --chat doctor
```

### Просмотр списка чатов:
```bash
python3 scripts/send_to_telegram.py --list
```

### Примеры отправки результатов анализов:
```bash
# Врачу
python3 scripts/send_to_telegram.py \
  Docs/Health/Medical-Records/2025-07-30-blood-test-telegram.txt \
  "Результаты анализов крови от 30.07.2025" \
  --chat doctor

# Себе (в чат по умолчанию)
python3 scripts/send_to_telegram.py \
  Docs/Health/Medical-Records/2025-07-30-blood-test-telegram.txt \
  "Результаты анализов крови от 30.07.2025"
```

## Безопасность

⚠️ **Важно:** Файл `telegram_config.json` содержит секретные данные (токен бота).

- Файл автоматически добавлен в `.gitignore` и не будет закоммичен в Git
- Не делитесь этим файлом и токеном бота с другими
- Если токен скомпрометирован, создайте нового бота через @BotFather

## Устранение проблем

### Ошибка: "Unauthorized"
- Проверьте, что токен бота правильный
- Убедитесь, что бот активен

### Ошибка: "Chat not found"
- Проверьте Chat ID
- Убедитесь, что вы отправили хотя бы одно сообщение боту перед использованием

### Ошибка: "Bad Request"
- Проверьте формат Chat ID (должно быть число или строка с числом)
- Убедитесь, что файл существует и доступен для чтения

